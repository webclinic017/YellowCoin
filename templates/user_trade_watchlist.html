{% extends 'user_base.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}
                  <div class="col-12 col-sm-12 col-md-8 col-lg-9 col-xl-9">
                     <div class="container-fluid">
                        <div class="row my-3">
                           <div class="col-3 text-start p-0 m-0 fs-small">
                              <span>SNX : {{senty.0.3}}</span>
                              <p>NFT : {{senty.1.3}}</p>
                           </div>
                           <div class="col-9 col-sm-9 col-md-9 col-lg-6 col-xl-6">
                              <div class="input-group shadow-sm ">
                                 <span class="input-group-text focus-none bg-transparent border-right-none" id="basic-addon1">
                                    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="magnifying-glass" class="svg-inline--fa fa-magnifying-glass hover-search" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" color="#fab417">
                                       <path fill="currentColor" d="M500.3 443.7l-119.7-119.7c27.22-40.41 40.65-90.9 33.46-144.7C401.8 87.79 326.8 13.32 235.2 1.723C99.01-15.51-15.51 99.01 1.724 235.2c11.6 91.64 86.08 166.7 177.6 178.9c53.8 7.189 104.3-6.236 144.7-33.46l119.7 119.7c15.62 15.62 40.95 15.62 56.57 0C515.9 484.7 515.9 459.3 500.3 443.7zM79.1 208c0-70.58 57.42-128 128-128s128 57.42 128 128c0 70.58-57.42 128-128 128S79.1 278.6 79.1 208z"></path>
                                    </svg>
                                 </span>
                                 <input type="text" onkeyup="filter()" id="search" autocomplete="off" class="form-control focus-none border-left-none" placeholder="Search..." aria-label="Username" aria-describedby="basic-addon1">
                              </div>
                           </div>
                           <div class="col-6 col-sm-6 col-md-6 col-lg-1 col-xl-1 text-center">
                              <div class="dropdown bg-transparent">
                                 <a class="btn focus-none" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false" href="/">
                                    <button type="button" class="position-relative border-none bg-transparent">
                                       <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bell" class="svg-inline--fa fa-bell fa-2x p-0 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" color="grey">
                                          <path fill="currentColor" d="M256 32V51.2C329 66.03 384 130.6 384 208V226.8C384 273.9 401.3 319.2 432.5 354.4L439.9 362.7C448.3 372.2 450.4 385.6 445.2 397.1C440 408.6 428.6 416 416 416H32C19.4 416 7.971 408.6 2.809 397.1C-2.353 385.6-.2883 372.2 8.084 362.7L15.5 354.4C46.74 319.2 64 273.9 64 226.8V208C64 130.6 118.1 66.03 192 51.2V32C192 14.33 206.3 0 224 0C241.7 0 256 14.33 256 32H256zM224 512C207 512 190.7 505.3 178.7 493.3C166.7 481.3 160 464.1 160 448H288C288 464.1 281.3 481.3 269.3 493.3C257.3 505.3 240.1 512 224 512z"></path>
                                       </svg>
                                       <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">3<span class="visually-hidden">unread messages</span></span>
                                    </button>
                                 </a>
                                 <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                    <li><a class="dropdown-item" href="/">Action</a></li>
                                    <li><a class="dropdown-item" href="/">Another action</a></li>
                                    <li><a class="dropdown-item" href="/">Something else here</a></li>
                                 </ul>
                              </div>
                           </div>
                           <div class="col-6 col-sm-6 col-md-6 col-lg-2 col-xl-2 d-flex flex-row">
                              <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle-user" class="svg-inline--fa fa-circle-user fa-2x mt-1" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                 <path fill="currentColor" d="M256 0C114.6 0 0 114.6 0 256s114.6 256 256 256s256-114.6 256-256S397.4 0 256 0zM256 128c39.77 0 72 32.24 72 72S295.8 272 256 272c-39.76 0-72-32.24-72-72S216.2 128 256 128zM256 448c-52.93 0-100.9-21.53-135.7-56.29C136.5 349.9 176.5 320 224 320h64c47.54 0 87.54 29.88 103.7 71.71C356.9 426.5 308.9 448 256 448z"></path>
                              </svg>
                              <div class="dropdown ms-1 bg-transparent">
                                 <a class="btn fw-bold focus-none" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false" href="/">
                                    {{current_user.username}}
                                    <span class="ps-2">
                                       <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="angle-down" class="svg-inline--fa fa-angle-down fw-bold" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                                          <path fill="currentColor" d="M192 384c-8.188 0-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L192 306.8l137.4-137.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-160 160C208.4 380.9 200.2 384 192 384z"></path>
                                       </svg>
                                    </span>
                                 </a>
                                 <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                    <li><a class="dropdown-item" href="/">Action</a></li>
                                    <li><a class="dropdown-item" href="/">Another action</a></li>
                                    <li><a class="dropdown-item" href="/">Something else here</a></li>
                                 </ul>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="container-fluid">
                        <div class="row">
                           <div class="col-6 col-sm-6 col-md-4 col-lg-2 col-xl-2">
                              <p class="m-2">SEGMENT</p>
                              <select id="segment" class="form-select bg-orange color-white height-button focus-none" aria-label="Default select example">
                                 <option class="bg-light text-dark ps-3" value="NSEFUT">NSEFUT</option>
                                 <option class="bg-light text-dark ps-3" value="MCXFUT">MCXFUT</option>
                                 <option class="bg-light text-dark ps-3" value="NSEOPT">NSEOPT</option>
                                 <option class="bg-light text-dark ps-3" value="GLOBAL FUTURES">GLOBAL FUTURES</option>
                                 <option class="bg-light text-dark ps-3" value="NSEEQT">NSEEQT</option>
                                 <option class="bg-light text-dark ps-3" value="NSECDS">NSECDS</option>
                              </select>
                           </div>
                           <div class="col-6 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                              <p class="m-2">SCRIPT</p>
                              <select id="script" class="form-select bg-orange color-white height-button focus-none" aria-label="Default select example">
                                 <option class="bg-light text-dark ps-3" value="1">Select...</option>
                                 {% for stock in stocksA %}
                                 <option class="bg-light text-dark ps-3" value="{{stock}}">{{stock}}</option>
                                 {% endfor %}
                              </select>
                           </div>
                           <div class="col-6 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                              <p class="m-2">EXPIRY</p>
                              <select class="form-select bg-orange color-white height-button focus-none" aria-label="Default select example">
                                 <option class="bg-light text-dark ps-3" value="1">31-03-2022</option>
                                 <option class="bg-light text-dark ps-3" value="2">One</option>
                                 <option class="bg-light text-dark ps-3" value="3">Two</option>
                                 <option class="bg-light text-dark ps-3" value="3">Three</option>
                              </select>
                           </div>
                           <div class="col-6 col-sm-6 col-md-6 col-lg-2 col-xl-2">
                              <p class="m-2">CE/PE</p>
                              <select class="form-select bg-orange color-white height-button focus-none" aria-label="Default select example">
                                 <option class="bg-light text-dark ps-3" value="2">One</option>
                                 <option class="bg-light text-dark ps-3" value="3">Two</option>
                                 <option class="bg-light text-dark ps-3" value="3">Three</option>
                              </select>
                           </div>
                           <div class="col-6 col-sm-6 col-md-6 col-lg-2 col-xl-2">
                              <p class="m-2">STRIKE</p>
                              <select class="form-select bg-orange color-white height-button focus-none" aria-label="Default select example">
                                 <option class="bg-light text-dark ps-3" value="1">Select...</option>
                                 <option class="bg-light text-dark ps-3" value="2">One</option>
                                 <option class="bg-light text-dark ps-3" value="3">Two</option>
                                 <option class="bg-light text-dark ps-3" value="3">Three</option>
                              </select>
                           </div>
                              <div class="col-6 col-sm-6 col-md-6 col-lg-2 col-xl-2">
                              <p class="m-2" style="opacity:0">SUBMIT</p>
                              <button onclick="SubmitData()" class="bg-orange color-white height-button focus-none" style="border-radius:20px; width: 70%; border-width: 0;" aria-label="Default select example">
                                 Submit
                              </button>
                           </div>
                        </div>
                     </div>
                     <div class="table-responsive ">
                        <table class="table my-5 table-borderless">
                           <thead>
                              <tr class="table-border-none">
                                 <th scope="col" class="bg-light ">NSEFUT SYM</th>
                                 <th scope="col" class="bg-light ">PRICE</th>
                                 <th scope="col" class="bg-light ">PREVIOUS CLOSE</th>
                                 <th scope="col" class="bg-light ">DAY RANGE</th>
                                 <th scope="col" class="bg-light ">YEAR RANGE</th>
                                 <th scope="col" class="bg-light ">VOLUME</th>
                                 <th scope="col" class="bg-light ">DIVIDEND YIELD</th>
                                 <th scope="col" class="bg-light ">REMOVE</th>
                              </tr>
                           </thead>
                           <tbody id="table">
                              {% for stock in dataArrFinal %}
                              <tr class="">
                                 <td class="td-border ">{{stock.0}}</td>
                                 <td class="td-border  bg-primary color-white">{{stock.1}}</td>
                                 <td class="td-border">{{stock.2}}</td>
                                 <td class="td-border ">{{stock.3}}</td>
                                 <td class="td-border ">{{stock.4}}</td>
                                 <td class="td-border ">
                                    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-up" class="svg-inline--fa fa-caret-up " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" color="green"><path fill="currentColor" d="M9.39 265.4l127.1-128C143.6 131.1 151.8 128 160 128s16.38 3.125 22.63 9.375l127.1 128c9.156 9.156 11.9 22.91 6.943 34.88S300.9 320 287.1 320H32.01c-12.94 0-24.62-7.781-29.58-19.75S.2333 274.5 9.39 265.4z"></path></svg>
                                    {{stock.5}}
                                 </td>
                                 <td class="td-border ">{{stock.7}}</td>
                                 <td class="td-border ">
                                    <button type="button" onclick="deleteR(this)" class="btn  mx-3 my-0 py-0 the-button">
                                       <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="xmark" class="svg-inline--fa fa-xmark fa-1x cross-size" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" color="red">
                                          <path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"></path>
                                       </svg>
                                    </button>
                                 </td>
                              </tr>
                              {% endfor %}
                           </tbody>
                        </table>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <script>
            function SubmitData()
            {
                  let segment = document.getElementById("segment").value;
                  let script = document.getElementById("script").value;
                  add(segment,script);
            }
            function add(segment,script)
            {
               let symbol = script;
               let fetchRes = fetch("../data?apiKey=qwertyuiop&todo=get&symbol=" + symbol);
               fetchRes.then(res =>
                  res.json()).then(d => {
                        console.log(d)
                        let table = document.getElementById('table');
                        table.innerHTML+=`<tr class="">
                                 <td class="td-border ">`+d['data'][0]['name']+`</td>
                                 <td class="td-border  bg-danger color-white">`+d['data'][0]['price']+`</td>
                                 <td class="td-border">`+d['data'][0]['priviousClose']+`</td>
                                 <td class="td-border">`+d['data'][0]['dayRange']+`</td>
                                 <td class="td-border ">`+d['data'][0]['yearRange']+`</td>
                                 <td class="td-border ">
                                    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-up" class="svg-inline--fa fa-caret-up " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" color="green"><path fill="currentColor" d="M9.39 265.4l127.1-128C143.6 131.1 151.8 128 160 128s16.38 3.125 22.63 9.375l127.1 128c9.156 9.156 11.9 22.91 6.943 34.88S300.9 320 287.1 320H32.01c-12.94 0-24.62-7.781-29.58-19.75S.2333 274.5 9.39 265.4z"></path></svg>
                                    `+d['data'][0]['volume']+`
                                 </td>
                                 <td class="td-border ">`+d['data'][0]['dividentYield']+`</td>
                                 <td class="td-border ">
                                    <button type="button" onclick="deleteR(this)" class="btn  mx-3 my-0 py-0 the-button">
                                       <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="xmark" class="svg-inline--fa fa-xmark fa-1x cross-size" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" color="red">
                                          <path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"></path>
                                       </svg>
                                    </button>
                                 </td>
                              </tr>`
                  })
            }
            function deleteR(element)
            {
               console.log("working");
               let table = document.getElementById('table');
               fetch("../data?apiKey=qwertyuiop&todo=delete&symbol="+ table.rows[element.parentNode.parentNode.rowIndex-1].cells[0].innerHTML, 
                  res =>
                  res.json()
               ).then((_res) => {
                  console.log();
               });
               console.log(table.rows[element.parentNode.parentNode.rowIndex-1].cells[0].innerHTML);
               table.deleteRow(element.parentNode.parentNode.rowIndex-1);
            }
            function filter() {
                  var input, filter, table, tr, td, i, txtValue;
                  input = document.getElementById("search");
                  filter = input.value.toUpperCase();
                  table = document.getElementById("table");
                  tr = table.getElementsByTagName("tr");
                  for (i = 0; i < tr.length; i++) {
                     td = tr[i].getElementsByTagName("td")[0];
                     console.log(td);
                     if (td) {
                     txtValue = td.textContent || td.innerText;
                     if (txtValue.toUpperCase().indexOf(filter) > -1) {
                           tr[i].style.display = "";
                     } else {
                           tr[i].style.display = "none";
                     }
                     }       
                  }
               }
            function DataUpdater()
            {
               let fetchRes = fetch("../data/?apiKey=asdfghjkl");
               fetchRes.then(res =>
                  res.json()).then(d => {
                        let data = d['data'];
                        for(let i=0; i < data.length; i++)
                        {
                           let symbol = data[i]['name'];
                           let table = document.getElementById("table");
                           let tr = table.getElementsByTagName("tr");
                           for(let j=0; j < tr.length; j++)
                           {
                              if(tr[j].cells[0].innerHTML == symbol)
                              {  
                                 let oldprice = tr[j].cells[1].innerHTML;
                                 oldprice = oldprice.replace(',','')
                                 let newPrice = data[i]['price'];
                                 newPrice = newPrice.replace(',','');
                                 if(parseFloat(oldprice.substring(1))>parseFloat(newPrice.substring(1)))
                                 {
                                    tr[j].cells[1].innerHTML = data[i]['price'];
                                    tr[j].cells[1].classList.add("bg-danger");
                                    tr[j].cells[1].classList.remove("bg-primary");
                                 }
                                 else
                                 {
                                    tr[j].cells[1].innerHTML = data[i]['price'];
                                    tr[j].cells[1].classList.add("bg-primary");
                                    tr[j].cells[1].classList.remove("bg-danger");
                                 }
                                 
                                 tr[j].cells[2].innerHTML = data[i]['priviousClose'];
                                 tr[j].cells[3].innerHTML = data[i]['dayRange'];
                                 tr[j].cells[4].innerHTML = data[i]['yearRange'];
                                 let oldvolume = tr[j].cells[5].innerText;
                                 oldvolume = oldvolume.replace(/\D/g, "");
                                 let newvolume = data[i]['volume'];
                                 newvolume = newvolume.replace(/\D/g, "");
                                 if(parseFloat(oldvolume.substring(1))>parseFloat(newvolume.substring(1)))
                                 {
                                    tr[j].cells[5].innerHTML = `<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-down" class="svg-inline--fa fa-caret-down " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" color="red"><path fill="currentColor" d="M310.6 246.6l-127.1 128C176.4 380.9 168.2 384 160 384s-16.38-3.125-22.63-9.375l-127.1-128C.2244 237.5-2.516 223.7 2.438 211.8S19.07 192 32 192h255.1c12.94 0 24.62 7.781 29.58 19.75S319.8 237.5 310.6 246.6z"></path></svg>`+ data[i]['volume'];
                                 }
                                 else
                                 {
                                    tr[j].cells[5].innerHTML = `<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-up" class="svg-inline--fa fa-caret-up " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" color="green"><path fill="currentColor" d="M9.39 265.4l127.1-128C143.6 131.1 151.8 128 160 128s16.38 3.125 22.63 9.375l127.1 128c9.156 9.156 11.9 22.91 6.943 34.88S300.9 320 287.1 320H32.01c-12.94 0-24.62-7.781-29.58-19.75S.2333 274.5 9.39 265.4z"></path></svg>`+ data[i]['volume'];
                                 }
                                 tr[j].cells[6].innerHTML = data[i]['dividentYield'];
                              }
                           }
                        }
                  })
                  stateChange();
            }
            function stateChange()
            {
               setTimeout(function(){ 
                  DataUpdater();
               }, 10000);
            }
            stateChange();
         </script>
{% endblock content %}