{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}
                    <div class="col-12 col-sm-12 col-md-8 col-lg-9 col-xl-9">
                        <div class="container-fluid">
                            <div class="row my-3">
                            <div class="col-3 fw-bold text-start p-0">
                                <div class="form-check ">
                                    <input class="form-check-input focus-none bg-orange" type="radio"  id="pending" name="orderType" >
                                    <label class="form-check-label " for="pending">PENDING ORDERS</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input focus-none bg-orange color-black" type="radio" id="executed" name="orderType" >
                                    <label class="form-check-label" for="executed">EXECUTED ORDERS</label>
                                </div>
                            </div>
                            <div class="col-9 col-sm-9 col-md-9 col-lg-6 col-xl-6">
                                <div class="input-group shadow-sm ">
                                    <span class="input-group-text focus-none bg-transparent border-right-none" id="basic-addon1">
                                        <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="magnifying-glass" class="svg-inline--fa fa-magnifying-glass hover-search" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" color="#fab417">
                                        <path fill="currentColor" d="M500.3 443.7l-119.7-119.7c27.22-40.41 40.65-90.9 33.46-144.7C401.8 87.79 326.8 13.32 235.2 1.723C99.01-15.51-15.51 99.01 1.724 235.2c11.6 91.64 86.08 166.7 177.6 178.9c53.8 7.189 104.3-6.236 144.7-33.46l119.7 119.7c15.62 15.62 40.95 15.62 56.57 0C515.9 484.7 515.9 459.3 500.3 443.7zM79.1 208c0-70.58 57.42-128 128-128s128 57.42 128 128c0 70.58-57.42 128-128 128S79.1 278.6 79.1 208z"></path>
                                        </svg>
                                    </span>
                                    <input type="text" onkeyup="filter()" id="search" autocomplete="off"  class="form-control focus-none border-left-none" placeholder="Search..." aria-label="Username" aria-describedby="basic-addon1">
                                </div>
                            </div>
                            <div class="col-6 col-sm-6 col-md-6 col-lg-1 col-xl-1 text-center">
                                <div class="dropdown bg-transparent">
                                    <a class="btn focus-none" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false" href="/">
                                        <button type="button" class="position-relative border-none bg-transparent">
                                        <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bell" class="svg-inline--fa fa-bell fa-2x p-0 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" color="grey">
                                            <path fill="currentColor" d="M256 32V51.2C329 66.03 384 130.6 384 208V226.8C384 273.9 401.3 319.2 432.5 354.4L439.9 362.7C448.3 372.2 450.4 385.6 445.2 397.1C440 408.6 428.6 416 416 416H32C19.4 416 7.971 408.6 2.809 397.1C-2.353 385.6-.2883 372.2 8.084 362.7L15.5 354.4C46.74 319.2 64 273.9 64 226.8V208C64 130.6 118.1 66.03 192 51.2V32C192 14.33 206.3 0 224 0C241.7 0 256 14.33 256 32H256zM224 512C207 512 190.7 505.3 178.7 493.3C166.7 481.3 160 464.1 160 448H288C288 464.1 281.3 481.3 269.3 493.3C257.3 505.3 240.1 512 224 512z"></path>
                                        </svg>
                                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">3<span class="visually-hidden">unread messages</span></span>
                                        </button>
                                    </a>
                                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                        <li><a class="dropdown-item" href="/">Action</a></li>
                                        <li><a class="dropdown-item" href="/">Another action</a></li>
                                        <li><a class="dropdown-item" href="/">Something else here</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-6 col-sm-6 col-md-6 col-lg-2 col-xl-2 d-flex flex-row">
                                <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle-user" class="svg-inline--fa fa-circle-user fa-2x mt-1" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                    <path fill="currentColor" d="M256 0C114.6 0 0 114.6 0 256s114.6 256 256 256s256-114.6 256-256S397.4 0 256 0zM256 128c39.77 0 72 32.24 72 72S295.8 272 256 272c-39.76 0-72-32.24-72-72S216.2 128 256 128zM256 448c-52.93 0-100.9-21.53-135.7-56.29C136.5 349.9 176.5 320 224 320h64c47.54 0 87.54 29.88 103.7 71.71C356.9 426.5 308.9 448 256 448z"></path>
                                </svg>
                                <div class="dropdown ms-1 bg-transparent">
                                    <a class="btn fw-bold focus-none" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false" href="/">
                                        {{current_user.username}}
                                        <span class="ps-2">
                                        <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="angle-down" class="svg-inline--fa fa-angle-down fw-bold" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                                            <path fill="currentColor" d="M192 384c-8.188 0-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L192 306.8l137.4-137.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-160 160C208.4 380.9 200.2 384 192 384z"></path>
                                        </svg>
                                        </span>
                                    </a>
                                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                        <li><a class="dropdown-item" href="/">Action</a></li>
                                        <li><a class="dropdown-item" href="/">Another action</a></li>
                                        <li><a class="dropdown-item" href="/">Something else here</a></li>
                                    </ul>
                                </div>
                            </div>
                            </div>
                        </div>
                        <div class="container">
                            <div class="row">
                            <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-3">
                                <p class="m-2">TRADE AFTER</p>
                                <input type="date" id="after"  class="bg-orange color-white w-100 height-button border-none px-3  cursor">
                            </div>
                            <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-3">
                                <p class="m-2">TRADE BEFORE</p>
                                <input type="date" id="before" class="bg-orange color-white w-100 height-button border-none px-3  cursor">
                            </div>
                            <div class="col-6 col-sm-6 col-md-6 col-lg-4 col-xl-2">
                                <p class="m-2">SELECT MARKET</p>
                                <select id="market" class="form-select bg-orange color-white height-button focus-none" aria-label="Default select example">
                                    <option class="bg-light text-dark ps-3" value="Select Market">Select Market</option>
                                    <option class="bg-light text-dark ps-3" value="NSEFUT">NSEFUT</option>
                                    <option class="bg-light text-dark ps-3" value="MCXFUT">MCXFUT</option>
                                    <option class="bg-light text-dark ps-3" value="NSEOPT">NSEOPT</option>
                                    <option class="bg-light text-dark ps-3" value="GLOBAL FUTURES">GLOBAL FUTURES</option>
                                    <option class="bg-light text-dark ps-3" value="NSEEQT">NSEEQT</option>
                                    <option class="bg-light text-dark ps-3" value="NSECDS">NSECDS</option>
                                </select>
                            </div>
                            <div class="col-6 col-sm-6 col-md-6 col-lg-4 col-xl-2">
                                <p class="m-2">SELECT SCRIPT</p>
                                <select id="script" class="form-select bg-orange color-white height-button focus-none" aria-label="Default select example">
                                    <option class="bg-light text-dark ps-3" value="Select Script">Select Script</option>
                                    {% for stock in stocksA %}
                                    <option class="bg-light text-dark ps-3" value="{{stock}}">{{stock}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-12 col-sm-6 col-md-6 col-lg-4 col-xl-2 ">
                                <p class="m-2">ORDER TYPE</p>
                                <select id="orderType" class="form-select bg-orange color-white height-button focus-none" aria-label="Default select example">
                                    <option class="bg-light text-dark ps-3" value="Select Order Type">Select Order Type</option>
                                    <option class="bg-light text-dark ps-3" value="Buy Limit">Buy Limit</option>
                                    <option class="bg-light text-dark ps-3" value="Buy Stop">Buy Stop</option>
                                    <option class="bg-light text-dark ps-3" value="Sell Limit">Sell Limit</option>
                                    <option class="bg-light text-dark ps-3" value="Sell Stop">Sell Stop</option>
                                </select>
                            </div>
                            </div>
                        </div>
                        <div class="container-fluid my-5">
                            <div class="row">
                            <div class="col-6 col-sm-6 col-md-6 col-lg-6 col-xl-6 text-center my-1">
                                <button type="button" onclick="setFilter()" class="btn btn-primary text-center btn-lg fs-6">FIND ORDER</button>
                            </div>
                            <div class="col-6 col-sm-6 col-md-6 col-lg-6 col-xl-6 text-center my-1">
                                <button type="button" onclick="clearFilter()" class="btn btn-info text-center btn-lg fs-6">CLEAR FILTER</button>
                            </div>
                            </div>
                        </div>
                        <div>
                            SHOW
                            <span>
                            <select class="form-select bg-orange color-white focus-none width-entry d-inline mx-2" aria-label="Default select example">
                                <option class="bg-light text-dark ps-3" value="10">10</option>
                                <option class="bg-light text-dark ps-3" value="20">20</option>
                                <option class="bg-light text-dark ps-3" value="30">30</option>
                                <option class="bg-light text-dark ps-3" value="40">40</option>
                            </select>
                            </span>
                            ENTRIES
                        </div>
                        <div class="table-responsive ">
                            <table class="table my-5 table-borderless">
                            <thead>
                                <tr class="table-border-none">
                                    <th scope="col" class="bg-light ">D</th>
                                    <th scope="col" class="bg-light ">TIME</th>
                                    <th scope="col" class="bg-light ">MARKET</th>
                                    <th scope="col" class="bg-light ">SCRIPT</th>
                                    <th scope="col" class="bg-light ">B/S</th>
                                    <th scope="col" class="bg-light ">ORDER TYPE</th>
                                    <th scope="col" class="bg-light ">LOT</th>
                                    <th scope="col" class="bg-light ">QTY</th>
                                    <th scope="col" class="bg-light ">ORDER PRICE</th>
                                    <th scope="col" class="bg-light ">STATUS</th>
                                    <th scope="col" class="bg-light ">O.TIME</th>
                                    <th scope="col" class="bg-light ">CANCEL</th>
                                </tr>
                            </thead>
                            <tbody class="bg-primary" id="table">
                                {% for trade in trades %}
                                <tr class="border-b">
                                <td id="title" class="text-light bg-primary">{{trade.id}}</td>
                                <td class="text-light bg-primary">{{trade.time}}</td>
                                <td class="text-light bg-primary">{{trade.market}}</td>
                                <td class="text-light bg-primary">{{trade.script}}</td>
                                <td class="text-light bg-primary">{{trade.bs}}</td>
                                <td class="text-light bg-primary">{{trade.orderType}}</td>
                                <td class="text-light bg-primary">{{trade.lot}}</td>
                                <td class="text-light bg-primary">{{trade.qty}}</td>
                                <td class="text-light bg-primary">{{trade.orderPrice}}</td>
                                <td class="text-light bg-primary">{{trade.status}}</td>
                                <td class="text-light bg-primary">{{trade.oTime}}</td>
                                <td class="text-light bg-primary">
                                    <button onclick="deleteR(this)" type="button">
                                        X
                                    </button>
                                </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                            </table>
                        </div>
                        <div class="d-flex flex-row-reverse bd-highlight">
                            <div class="p-2 bd-highlight">
                            <div class="container float-end w-100">
                                <nav aria-label="Page navigation example float-end">
                                    <ul class="pagination">
                                        <li class="page-item"><a class="page-link text-dark border-none mx-1" href="/">Previous</a></li>
                                        <li class="page-item"><a class="page-link text-dark border rounded border-dark" href="/">1</a></li>
                                        <li class="page-item"><a class="page-link text-dark border-none mx-1" href="/">Next</a></li>
                                    </ul>
                                </nav>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            </div>
        </div>
        <script>
            function filter() {
                var input, filter, table, tr, td, i, txtValue;
                input = document.getElementById("search");
                filter = input.value.toUpperCase();
                table = document.getElementById("table");
                tr = table.getElementsByTagName("tr");
                for (i = 0; i < tr.length; i++) {
                    td = tr[i].getElementsByTagName("td")[3];
                    if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                    }       
                }
            }
            function filterInd(x,input) {
                var filter, table, tr, td, i, txtValue;
                filter = input
                table = document.getElementById("table");
                tr = table.getElementsByTagName("tr");
                for (i = 0; i < tr.length; i++) {
                    td = tr[i].getElementsByTagName("td")[x];
                    if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                    }       
                }
            }
            function deleteR(element)
            {
                let text = "Are You sure you want to delete this Transcation?\nThis action cannot be undone.\nTranscation details : \n ID : "+element.parentNode.parentNode.childNodes[1].innerHTML + "\n Market : " + element.parentNode.parentNode.childNodes[5].innerHTML + "\n Script : " + element.parentNode.parentNode.childNodes[7].innerHTML + "\n Order Price : " + element.parentNode.parentNode.childNodes[19].innerHTML + "\n Quantity : " + element.parentNode.parentNode.childNodes[17].innerHTML + "\n Lot : " + element.parentNode.parentNode.childNodes[15].innerHTML + "\n Date : " + element.parentNode.parentNode.childNodes[3].innerHTML ;
                if (confirm(text) == true) {
                    let table = document.getElementById('table');
                    table.deleteRow(element.parentNode.parentNode.rowIndex-1);
                    fetch("../tradesRemove?"+"id="+element.parentNode.parentNode.childNodes[1].innerHTML,
                    res =>
                    res.json()
                    ).then((_res) => {
                        console.log();
                    });
                }
            }
            function clearFilter()
            {   
                if (document.getElementById('pending').checked) {
                    document.getElementById('pending').checked = false;
                }
                else
                {
                    document.getElementById('executed').checked = false;
                }
                document.getElementById("after").value = "";
                document.getElementById("before").value = "";
                document.getElementById("market").value = "Select Market";
                document.getElementById("script").value = "Select Script";
                document.getElementById("orderType").value = "Select Order Type";
                table = document.getElementById("table");
                tr = table.getElementsByTagName("tr");
                for (i = 0; i < tr.length; i++) {
                        tr[i].style.display = "";
                }       
            }
            function setFilter()
            {
                let decision = "";
                decision = document.getElementById('pending').checked ? "pending" : "executed";
                console.log(decision);
                let after = document.getElementById("after").value;
                let before = document.getElementById("before").value;
                let market = document.getElementById("market").value;
                let script = document.getElementById("script").value;
                let ordertype = document.getElementById("orderType").value;
                if(decision!="")
                {
                    filterInd(9,decision);
                }
                if(market!="Select Market")
                {
                    filterInd(2,market);
                }
                if(script!="Select Script")
                {
                    filterInd(3,script);
                }
                if(ordertype!="Select Order Type")
                {
                    filterInd(5,ordertype);
                }
            }
        </script>
{% endblock content %}